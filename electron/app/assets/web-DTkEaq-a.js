import{W as c}from"./index-CxQMM4wp.js";import u from"hls.js";const y=["file","extension","filetype","type","ext"],v={mp4:"video/mp4",webm:"video/mp4",cmaf:"video/mp4",cmfv:"video/mp4",m3u8:"application/x-mpegURL"};class h{constructor(e,t,i,s,l,r,n,o,a,d){this.pipMode=!1,this._videoType=null,this._videoContainer=null,this._firstReadyToPlay=!0,this._isEnded=!1,this._videoRate=1,this._videoExitOnEnd=!0,this._videoLoopOnEnd=!1,this._url=t,this._container=n,this._mode=e,this._width=a||320,this._height=d||180,this._mode=e,this._videoRate=s,this._zIndex=o||1,this._playerId=i,this._videoExitOnEnd=l,this._videoLoopOnEnd=r}async initialize(){if(this._getVideoType()){this._mode==="fullscreen"&&(this._container.style.position="absolute",this._container.style.width="100vw",this._container.style.height="100vh"),this._mode==="embedded"&&(this._container.style.position="relative",this._container.style.width=this._width.toString()+"px",this._container.style.height=this._height.toString()+"px"),this._container.style.left="0",this._container.style.top="0",this._container.style.display="flex",this._container.style.alignItems="center",this._container.style.justifyContent="center",this._container.style.backgroundColor="#000000",this._container.style.zIndex=this._zIndex.toString();const t=this._mode==="fullscreen"?window.innerWidth:this._width,i=this._mode==="fullscreen"?window.innerHeight:this._height,s="http://www.w3.org/2000/svg",l=document.createElementNS(s,"svg");l.setAttributeNS(null,"width",t.toString()),l.setAttributeNS(null,"height",i.toString());const r="0 0 "+t.toString()+" "+i.toString();l.setAttributeNS(null,"viewBox",r),l.style.zIndex=(this._zIndex+1).toString();const n=document.createElementNS(s,"rect");n.setAttributeNS(null,"x","0"),n.setAttributeNS(null,"y","0"),n.setAttributeNS(null,"width",t.toString()),n.setAttributeNS(null,"height",i.toString()),n.setAttributeNS(null,"fill","#000000"),l.appendChild(n),this._container.appendChild(l);const o=t*this._height/this._width;this._videoContainer=document.createElement("div"),this._videoContainer.style.position="absolute",this._videoContainer.style.left="0",this._videoContainer.style.width=t.toString()+"px",this._videoContainer.style.height=o.toString()+"px",this._videoContainer.style.zIndex=(this._zIndex+2).toString(),this._container.appendChild(this._videoContainer),await this.createVideoElement(t,o)||this._createEvent("Exit",this._playerId,"Video Error: failed to create the Video Element")}else this._createEvent("Exit",this._playerId,"Url Error: type not supported")}async createVideoElement(e,t){this.videoEl=document.createElement("video"),this.videoEl.controls=!0,this.videoEl.style.zIndex=(this._zIndex+3).toString(),this.videoEl.style.width=`${e.toString()}px`,this.videoEl.style.height=`${t.toString()}px`,this.videoEl.playbackRate=this._videoRate,this._videoContainer.appendChild(this.videoEl);const i=await this._setPlayer();if(i&&(this.videoEl.onended=async()=>{this._isEnded=!0,this.isPlaying=!1,this.videoEl&&(this.videoEl.currentTime=0),this._videoExitOnEnd?(this._mode==="fullscreen"&&this._closeFullscreen(),this._createEvent("Ended",this._playerId)):this._videoLoopOnEnd&&this.videoEl!=null&&await this.videoEl.play()},this.videoEl.oncanplay=async()=>{this._firstReadyToPlay&&(this._createEvent("Ready",this._playerId),this.videoEl!=null&&(this.videoEl.muted=!1,this._mode==="fullscreen"&&await this.videoEl.play(),this._firstReadyToPlay=!1))},this.videoEl.onplay=()=>{this.isPlaying=!0,this._firstReadyToPlay&&(this._firstReadyToPlay=!1),this._createEvent("Play",this._playerId)},this.videoEl.onplaying=()=>{this._createEvent("Playing",this._playerId)},this.videoEl.onpause=()=>{this.isPlaying=!1,this._createEvent("Pause",this._playerId)},this._mode==="fullscreen")){const s=document.createElement("button");s.textContent="X",s.style.position="absolute",s.style.left="1%",s.style.top="5%",s.style.width="5vmin",s.style.padding="0.5%",s.style.fontSize="1.2rem",s.style.background="rgba(51,51,51,.4)",s.style.color="#fff",s.style.visibility="hidden",s.style.zIndex=(this._zIndex+4).toString(),s.style.border="1px solid rgba(51,51,51,.4)",s.style.borderRadius="20px",this._videoContainer.onclick=async()=>{this._initial=await this._doHide(s,3e3)},this._videoContainer.ontouchstart=async()=>{this._initial=await this._doHide(s,3e3)},this._videoContainer.onmousemove=async()=>{this._initial=await this._doHide(s,3e3)},s.onclick=()=>{this._createEvent("Exit",this._playerId)},s.ontouchstart=()=>{this._createEvent("Exit",this._playerId)},this._videoContainer.appendChild(s),this._initial=await this._doHide(s,3e3),this._goFullscreen()}return i}async _goFullscreen(){this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.requestFullscreen&&this._container.requestFullscreen()}async _setPlayer(){return new Promise(e=>{if(this.videoEl!=null){if(u.isSupported()&&this._videoType==="application/x-mpegURL"){const t=new u;t.loadSource(this._url),t.attachMedia(this.videoEl),t.once(u.Events.FRAG_PARSED,()=>{this.videoEl!=null?(this.videoEl.muted=!0,this.videoEl.crossOrigin="anonymous",e(!0)):e(!1)})}else this._videoType==="video/mp4"?(this.videoEl.src=this._url,this._url.substring(0,5)!="https"&&this._url.substring(0,4)==="http"&&(this.videoEl.crossOrigin="anonymous"),(this._url.substring(0,5)==="https"||this._url.substring(0,4)==="http")&&(this.videoEl.muted=!0),e(!0)):e(!1);this.videoEl.addEventListener("enterpictureinpicture",t=>{this.pipWindow=t.pictureInPictureWindow,this.pipMode=!0,this._closeFullscreen()}),this.videoEl.addEventListener("leavepictureinpicture",()=>{this.pipMode=!1,this._isEnded||(this._goFullscreen(),this.videoEl!=null&&this.videoEl.play())})}else e(!1)})}_getVideoType(){const e=this._url?this._url:"";return e!=null&&e.length>0?(Object.entries(v).forEach(([s,l])=>{if(e.match(new RegExp(`.(${s})`,"i")))return this._videoType=l;if(e.match(new RegExp(`(${s})`,"i")))return this._videoType=l}),e.match(/\.(.*)/i)?this._videoType=null:e.match(new RegExp(`(${y.join("|")})=+(.*)&?(?=&|$))`,"i"))?this._videoType=null:"video/mp4"):null}async _doHide(e,t){return clearTimeout(this._initial),e.style.visibility="visible",setTimeout(()=>{e.style.visibility="hidden"},t)}_createEvent(e,t,i){const s=i||null;let l;if(s!=null)l=new CustomEvent(`videoPlayer${e}`,{detail:{fromPlayerId:t,message:s}});else{const r=this.videoEl?this.videoEl.currentTime:0;l=new CustomEvent(`videoPlayer${e}`,{detail:{fromPlayerId:t,currentTime:r}})}document.dispatchEvent(l)}_closeFullscreen(){const e=document;(e.fullscreenElement&&e.fullscreenElement!==null||e.webkitFullscreenElement&&e.webkitFullscreenElement!==null||e.mozFullScreenElement&&e.mozFullScreenElement!==null||e.msFullscreenElement&&e.msFullscreenElement!==null)&&(e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.exitFullscreen&&e.exitFullscreen())}}class _ extends c{constructor(){super(),this._players=[],this.addListeners()}async echo(e){return Promise.resolve({result:!0,method:"echo",value:e})}async initPlayer(e){if(e==null)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a capVideoPlayerOptions object"});if(this.mode=e.mode?e.mode:"",this.mode==null||this.mode.length===0)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Mode (fullscreen/embedded)"});if(this.mode==="fullscreen"||this.mode==="embedded"){const t=e.url?e.url:"";if(t==null||t.length===0)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Video Url"});if(t=="internal")return Promise.resolve({result:!1,method:"initPlayer",message:"Internal Videos not supported on Web Platform"});const i=e.playerId?e.playerId:"";if(i==null||i.length===0)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Player Id"});const s=e.rate?e.rate:1;let l=!0;if(Object.keys(e).includes("exitOnEnd")){const d=e.exitOnEnd;l=d??!0}let r=!1;if(Object.keys(e).includes("loopOnEnd")&&!l){const d=e.loopOnEnd;r=d??!1}const n=e.componentTag?e.componentTag:"";if(n==null||n.length===0)return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Component Tag"});let o=null;this.mode==="embedded"&&(o=this.checkSize(e));const a=await this._initializeVideoPlayer(t,i,this.mode,s,l,r,n,o);return Promise.resolve({result:a})}else return Promise.resolve({result:!1,method:"initPlayer",message:"Must provide a Mode either fullscreen or embedded)"})}async isPlaying(e){if(e==null)return Promise.resolve({result:!1,method:"isPlaying",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].isPlaying;return Promise.resolve({method:"isPlaying",result:!0,value:i})}else return Promise.resolve({method:"isPlaying",result:!1,message:"Given PlayerId does not exist)"})}async play(e){if(e==null)return Promise.resolve({result:!1,method:"play",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";return(t==null||t.length===0)&&(t="fullscreen"),this._players[t]?(await this._players[t].videoEl.play(),Promise.resolve({method:"play",result:!0,value:!0})):Promise.resolve({method:"play",result:!1,message:"Given PlayerId does not exist)"})}async pause(e){if(e==null)return Promise.resolve({result:!1,method:"pause",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";return(t==null||t.length===0)&&(t="fullscreen"),this._players[t]?(this._players[t].isPlaying&&await this._players[t].videoEl.pause(),Promise.resolve({method:"pause",result:!0,value:!0})):Promise.resolve({method:"pause",result:!1,message:"Given PlayerId does not exist)"})}async getDuration(e){if(e==null)return Promise.resolve({result:!1,method:"getDuration",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].videoEl.duration;return Promise.resolve({method:"getDuration",result:!0,value:i})}else return Promise.resolve({method:"getDuration",result:!1,message:"Given PlayerId does not exist)"})}async setRate(e){if(e==null)return Promise.resolve({result:!1,method:"setRate",message:"Must provide a capVideoRateOptions object"});let t=e.playerId?e.playerId:"";(t==null||t.length===0)&&(t="fullscreen");const i=[.25,.5,.75,1,2,4],s=e.rate&&i.includes(e.rate)?e.rate:1;return this._players[t]?(this._players[t].videoEl.playbackRate=s,Promise.resolve({method:"setRate",result:!0,value:s})):Promise.resolve({method:"setRate",result:!1,message:"Given PlayerId does not exist)"})}async getRate(e){if(e==null)return Promise.resolve({result:!1,method:"getRate",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].videoEl.playbackRate;return Promise.resolve({method:"getRate",result:!0,value:i})}else return Promise.resolve({method:"getRate",result:!1,message:"Given PlayerId does not exist)"})}async setVolume(e){if(e==null)return Promise.resolve({result:!1,method:"setVolume",message:"Must provide a capVideoVolumeOptions object"});let t=e.playerId?e.playerId:"";(t==null||t.length===0)&&(t="fullscreen");const i=e.volume?e.volume:.5;return this._players[t]?(this._players[t].videoEl.volume=i,Promise.resolve({method:"setVolume",result:!0,value:i})):Promise.resolve({method:"setVolume",result:!1,message:"Given PlayerId does not exist)"})}async getVolume(e){if(e==null)return Promise.resolve({result:!1,method:"getVolume",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].videoEl.volume;return Promise.resolve({method:"getVolume",result:!0,value:i})}else return Promise.resolve({method:"getVolume",result:!1,message:"Given PlayerId does not exist)"})}async setMuted(e){if(e==null)return Promise.resolve({result:!1,method:"setMuted",message:"Must provide a capVideoMutedOptions object"});let t=e.playerId?e.playerId:"";(t==null||t.length===0)&&(t="fullscreen");const i=e.muted?e.muted:!1;return this._players[t]?(this._players[t].videoEl.muted=i,Promise.resolve({method:"setMuted",result:!0,value:i})):Promise.resolve({method:"setMuted",result:!1,message:"Given PlayerId does not exist)"})}async getMuted(e){if(e==null)return Promise.resolve({result:!1,method:"getMuted",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].videoEl.muted;return Promise.resolve({method:"getMuted",result:!0,value:i})}else return Promise.resolve({method:"getMuted",result:!1,message:"Given PlayerId does not exist)"})}async setCurrentTime(e){if(e==null)return Promise.resolve({result:!1,method:"setCurrentTime",message:"Must provide a capVideoTimeOptions object"});let t=e.playerId?e.playerId:"";(t==null||t.length===0)&&(t="fullscreen");let i=e.seektime?e.seektime:0;if(this._players[t]){const s=this._players[t].videoEl.duration;return i=i<=s&&i>=0?i:s/2,this._players[t].videoEl.currentTime=i,Promise.resolve({method:"setCurrentTime",result:!0,value:i})}else return Promise.resolve({method:"setCurrentTime",result:!1,message:"Given PlayerId does not exist)"})}async getCurrentTime(e){if(e==null)return Promise.resolve({result:!1,method:"getCurrentTime",message:"Must provide a capVideoPlayerIdOptions object"});let t=e.playerId?e.playerId:"";if((t==null||t.length===0)&&(t="fullscreen"),this._players[t]){const i=this._players[t].videoEl.currentTime;return Promise.resolve({method:"getCurrentTime",result:!0,value:i})}else return Promise.resolve({method:"getCurrentTime",result:!1,message:"Given PlayerId does not exist)"})}async stopAllPlayers(){for(const e in this._players){if(this._players[e].pipMode){const t=document;t.pictureInPictureElement&&await t.exitPictureInPicture()}this._players[e].videoEl.paused||this._players[e].videoEl.pause()}return Promise.resolve({method:"stopAllPlayers",result:!0,value:!0})}async showController(){return Promise.resolve({method:"showController",result:!0,value:!0})}async isControllerIsFullyVisible(){return Promise.resolve({method:"isControllerIsFullyVisible",result:!0,value:!0})}async exitPlayer(){return Promise.resolve({method:"exitPlayer",result:!0,value:!0})}checkSize(e){const t={width:e.width?e.width:320,height:e.height?e.height:180},i=t.height/t.width;return t.width>window.innerWidth&&(t.width=window.innerWidth,t.height=Math.floor(t.width*i)),t.height>window.innerHeight&&(t.height=window.innerHeight,t.width=Math.floor(t.height/i)),t}async _initializeVideoPlayer(e,t,i,s,l,r,n,o){const a=e?e.indexOf("%2F")==-1?encodeURI(e):e:null;if(a===null)return Promise.resolve(!1);if(this.videoContainer=await this._getContainerElement(t,n),this.videoContainer===null)return Promise.resolve({method:"initPlayer",result:!1,message:"componentTag or divContainerElement must be provided"});if(i==="embedded"&&o==null)return Promise.resolve({method:"initPlayer",result:!1,message:"playerSize must be defined in embedded mode"});if(i==="embedded")this._players[t]=new h("embedded",a,t,s,l,r,this.videoContainer,2,o.width,o.height),await this._players[t].initialize();else if(i==="fullscreen")this._players.fullscreen=new h("fullscreen",a,"fullscreen",s,l,r,this.videoContainer,99995),await this._players.fullscreen.initialize();else return Promise.resolve({method:"initPlayer",result:!1,message:"mode not supported"});return Promise.resolve({method:"initPlayer",result:!0,value:!0})}async _getContainerElement(e,t){const i=document.createElement("div");if(i.id=`vc_${e}`,t!=null&&t.length>0){const s=document.querySelector(`${t}`);if(s===null)return Promise.resolve(null);let l=null;const r=s.shadowRoot?s.shadowRoot:null;return r!=null?l=r.querySelector(`[id='${e}']`):l=s.querySelector(`[id='${e}']`),l!=null&&l.appendChild(i),Promise.resolve(i)}else return Promise.resolve(null)}handlePlayerPlay(e){this.notifyListeners("jeepCapVideoPlayerPlay",e)}handlePlayerPause(e){this.notifyListeners("jeepCapVideoPlayerPause",e)}handlePlayerEnded(e){var t;this.mode==="fullscreen"&&((t=this.videoContainer)===null||t===void 0||t.remove()),this.removeListeners(),this.notifyListeners("jeepCapVideoPlayerEnded",e)}handlePlayerExit(){var e;this.mode==="fullscreen"&&((e=this.videoContainer)===null||e===void 0||e.remove());const t={dismiss:!0};this.removeListeners(),this.notifyListeners("jeepCapVideoPlayerExit",t)}handlePlayerReady(e){this.notifyListeners("jeepCapVideoPlayerReady",e)}addListeners(){document.addEventListener("videoPlayerPlay",e=>{this.handlePlayerPlay(e.detail)},!1),document.addEventListener("videoPlayerPause",e=>{this.handlePlayerPause(e.detail)},!1),document.addEventListener("videoPlayerEnded",e=>{this.handlePlayerEnded(e.detail)},!1),document.addEventListener("videoPlayerReady",e=>{this.handlePlayerReady(e.detail)},!1),document.addEventListener("videoPlayerExit",()=>{this.handlePlayerExit()},!1)}removeListeners(){document.removeEventListener("videoPlayerPlay",e=>{this.handlePlayerPlay(e.detail)},!1),document.removeEventListener("videoPlayerPause",e=>{this.handlePlayerPause(e.detail)},!1),document.removeEventListener("videoPlayerEnded",e=>{this.handlePlayerEnded(e.detail)},!1),document.removeEventListener("videoPlayerReady",e=>{this.handlePlayerReady(e.detail)},!1),document.removeEventListener("videoPlayerExit",()=>{this.handlePlayerExit()},!1)}}export{_ as CapacitorVideoPlayerWeb};
